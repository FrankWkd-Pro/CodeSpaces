# RMQå­¦ä¹ ç¬”è®°
å‰è¨€:è¿™ä¸ªç®—æ³•æ— è®ºæ˜¯ä»é€‚é…æ€§è¿˜æ˜¯é•¿åº¦æ¥è¯´éƒ½å¾ˆæœ‰å®åŠ›...ğŸ’¦

## å…³äº RMQ
RMQ æ˜¯è‹±æ–‡ Range Maximum/Minimum Query çš„ç¼©å†™ï¼Œè¡¨ç¤ºåŒºé—´æœ€å¤§ï¼ˆæœ€å°ï¼‰å€¼ã€‚

## è¯¦ç»†ä¿¡æ¯

## æ±‚ $l-r$ åŒºé—´å†…çš„æœ€å¤§/æœ€å°æ•°.
### åŒºé—´æ„é€ 
 - æœ¬è´¨æ˜¯DP.è®¾ $f[i][j]$ ä¸º $i\sim i+2^{j-1}$ çš„åŒºé—´æœ€å¤§å€¼.ç‰¹åˆ«åœ°,$f[i][0]=a[i]$.(ä¸€ä¸ªæ•°çš„æœ€å¤§å€¼æ˜¯å®ƒæœ¬èº«).
 - çŠ¶æ€è½¬ç§»æ–¹ç¨‹: $f[i][j]=max(f[i][j-1],f[i+2^{j-1}][j-1])$.
### åŒºé—´æŸ¥è¯¢
- è®¾è¦æŸ¥è¯¢çš„åŒºé—´ä¸º $[L,R]$ (åŒ…æ‹¬LR)
- $$k = log2(R-L+1)$$
- $$res[L][R] = max(f[L][K],f[R-2^k+1][k])$$
- æ³¨æ„:ä¸ºä¿è¯ç²¾åº¦,è¯·è‡ªå·±æ¨å¯¼ $2^k$ ,è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ $log$ å‡½æ•°.
### æ—¶é—´å¤æ‚åº¦: $O(nlog_2n)$

### A. è¶…çº§è®°å¿†åŠ›

#### é¢˜ç›®æè¿°

å°AåŒå­¦æ‹¥æœ‰æ— ä¸ä¼¦æ¯”çš„è¶…çº§è®°å¿†åŠ›ï¼Œä»–å¯ä»¥ä¸€æ¬¡æ€§è®°ä½å¾ˆå¤šæ•°å­—ã€‚

ä¸ºäº†è€ƒéªŒä¸€ä¸‹å°AåŒå­¦çš„è®°å¿†åŠ›ï¼Œç‹è€å¸ˆä¸€æ¬¡æ€§ç»™å°Aå±•ç¤ºäº† $N$ ä¸ªæ•´æ•°ã€‚ç„¶åé—®äº†ä»– $M$ ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªé—®é¢˜ç»™å®šä¸€ä¸ªåŒºé—´ï¼Œè¦æ±‚å°AåŒå­¦è¯´å‡ºè¿™ä¸ªåŒºé—´ä¸­çš„æœ€å¤§æ•°æ˜¯å¤šå°‘ï¼Ÿ

ä¸ºæ–¹ä¾¿è€å¸ˆæ£€éªŒå°AåŒå­¦çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼Œè¯·ä½ å…ˆç¼–ç¨‹æ±‚å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚

#### è¾“å…¥

ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° $N,M$ è¡¨ç¤ºæ•°å­—çš„ä¸ªæ•°å’Œè¦è¯¢é—®çš„æ¬¡æ•°ï¼›

æ¥ä¸‹æ¥ä¸€è¡Œä¸º $N$ ä¸ªæ•°ï¼›

æ¥ä¸‹æ¥ $M$ è¡Œï¼Œæ¯è¡Œéƒ½æœ‰ä¸¤ä¸ªæ•´æ•° $X,Y$ è¡¨ç¤ºè¯¢é—®çš„åŒºé—´ã€‚

#### æ•°æ®èŒƒå›´ï¼š

$1â‰¤Nâ‰¤10^5,1â‰¤Mâ‰¤10^6,1â‰¤Xâ‰¤Yâ‰¤N$ã€‚æ•°å­—ä¸è¶…è¿‡ C/C++ çš„ int èŒƒå›´ã€‚
#### è§£æ³•:
- æ¿å­,æ²¡ä»€ä¹ˆå¯è¯´çš„.æ³¨æ„:è¦å¼€scanf!
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e5 + 10, L = 20;
int a[N], f[N][L];
int lg[N];
int n, m, x, y, k;
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i++) {
        scanf("%d", &a[i]);
    }
    lg[1] = 0;
    for (int i = 2; i <= n; i++) lg[i] = lg[i / 2] + 1;
    for (int j = 0; j < L; j++) {
        for (int i = 1; i + (1 << j) - 1 <= n; i++) {
            if (j == 0)
                f[i][j] = a[i];
            else
                f[i][j] = max(f[i][j - 1], f[i + (1 << j - 1)][j - 1]);
        }
    }
    while (m--) {
        scanf("%d%d", &x, &y);
        k = lg[y - x + 1];
        printf("%d\n", max(f[x][k], f[y - (1 << k) + 1][k]));
    }
}
```

### B. è£è€€ä¹‹æˆ˜

#### é¢˜ç›®æè¿°

å° $A$ æ˜¯ä¸€åæ¸¸æˆç©å®¶ï¼Œä»–æ­£åœ¨ç©ä¸€æ¬¾å«åšâ€œè£è€€ä¹‹æˆ˜â€çš„æ¸¸æˆã€‚åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä»–éœ€è¦é€šè¿‡å®Œæˆä»»åŠ¡æ¥æå‡è‡ªå·±çš„ç­‰çº§ã€‚

æ¸¸æˆåœ°å›¾ä¸Šæœ‰ $N$ ä¸ªæ’æˆä¸€æ’çš„è£…å¤‡ï¼Œæ¯ä¸ªè£…å¤‡éƒ½æ ‡æ³¨å¥½äº†ç»éªŒå€¼å’Œå±é™©å€¼ï¼Œç¬¬ $i$ ä¸ªè£…å¤‡çš„ç»éªŒå€¼ä¸º $V_i$ å±é™©å€¼ä¸º $D_i$ã€‚

å° $A$ æ¥åˆ°äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä»–éœ€è¦åœ¨è¿™ $N$ ä¸ªè£…å¤‡ä¸­ï¼Œé€‰å–**è¿ç»­çš„**è‹¥å¹²ä¸ªè£…å¤‡ï¼Œå¹¶ä½¿å¾—è¿™äº›è£…å¤‡çš„ç»éªŒå€¼æ€»å’Œä¸å°äº $K$ï¼ˆ$\ge K$ï¼‰ã€‚åŒæ—¶è¦ä½¿å¾—è¿™äº›è£…å¤‡çš„æœ€å¤§çš„å±é™©å€¼å°½å¯èƒ½çš„å°ã€‚

è¯·ç¼–ç¨‹è®¡ç®—å‡ºï¼Œæ»¡è¶³é¢˜æ„çš„æ–¹æ¡ˆä¸­ï¼Œæœ€å¤§çš„å±é™©å€¼æœ€å°æ˜¯å¤šå°‘ï¼Ÿ

è¾“å…¥

ç¬¬ $1$ è¡Œè¯»å…¥ $2$ ä¸ªæ•´æ•° $N,K$ã€‚

æ¥ä¸‹æ¥ $N$ è¡Œï¼Œæ¯è¡Œè¯»å…¥ $2$ ä¸ªæ•´æ•° $V_i,D_i$ ï¼Œåˆ†åˆ«è¡¨ç¤ºæ¯ä¸ªè£…å¤‡çš„ç»éªŒå€¼å’Œå±é™©å€¼ã€‚


#### æ•°æ®èŒƒå›´

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 \le N \le 10^5$ï¼Œ$1 \le V_i,D_i \le 10^9$ï¼Œ$1 \le K \le 10^{18}$ã€‚

- è¦é€‰å‡ºä¸€ä¸ªåŒºé—´,ä½¿å¾—ä»–ä»¬åœ¨ $V_i\ge K$ çš„æƒ…å†µä¸‹ $D_i$ çš„æ€»å’Œæœ€å°.èƒ½å¤Ÿè½¬åŒ–ä¸º: é€‰æ‹© $V_l+V_{i+1}+...+V_r \ge K$ ä¸”  $D_l+D_{i+1}+...+D_r $ æœ€å°.å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨åŒæŒ‡é’ˆæ¥è§£å†³.æ³¨æ„:ä¸€å®šè¦è®©å·²ç»è¿‡å»çš„æ•°å‡ºé˜Ÿ!!!
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 10;
const int L = 20;
long long a[N];
long long lg[N], f[N][L];
long long n, m, v[N], w[N];
#define value long long
value max(value a, value b) {
    return a > b ? a : b;
}
value min(value a, value b) {
    return a < b ? a : b;
}
int main() {
    cin >> n >> m;
    for (int i = 1; i <= n; i++) {
        scanf("%lld%lld", &v[i], &w[i]);
    }
    lg[1] = 0;
    for (int i = 2; i <= n; i++) {
        lg[i] = lg[i / 2] + 1;
    }
    for (int i = 0; i < L; i++) {
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)
                f[j][i] = w[j];
            else
                f[j][i] = max(f[j][i - 1], f[j + (1 << (i - 1))][i - 1]);
        }
    }
    long long r = 0, sum = 0;
    long long ans = INT_MAX;
    for (int l = 1; l <= n; l++) {
        while (r + 1 <= n and sum < m) {
            sum += v[++r];
        }
        if (sum >= m) {
            long long
                len = lg[r - l + 1];
            ans = min(ans, max(f[l][len], f[r - (1 << len) + 1][len]));
        }
        sum -= v[l];  // ä¸€å®šè¦æ³¨æ„è®©å·²ç»è¿‡å»çš„æ•°å‡ºé˜Ÿ!!!!
    }

    printf("%lld\n", ans);
}
```

### C.å¼‚æˆ–
#### é¢˜ç›®å†…å®¹
æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $N$ çš„æ•°åˆ— $A_1,A_2,\dots,A_n$ã€‚

è¯·é—®è¯¥æ•°åˆ—ä¸­ä»»æ„å–ä¸€ä¸ªåŒºé—´ $[L,R]$ ä¸­ï¼Œæ˜¯å¦å­˜åœ¨ $2$ ä¸ªæ•°ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªæ•°å¼‚æˆ–çš„ç»“æœä¸º $T$ã€‚

è¯·æ³¨æ„ï¼Œæœ¬é¢˜ä¼šå‘èµ· $M$ æ¬¡è¯¢é—®ï¼Œå¯¹äºæ¯æ¬¡è¯¢é—®çš„åŒºé—´ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ç¬¦åˆé¢˜æ„çš„æ•°å¯¹ï¼Œè¯·è¾“å‡º `yes`ï¼Œå¦åˆ™è¯·è¾“å‡º `no`ã€‚

#### è¾“å…¥
ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $n, m, T$ ã€‚

ç¬¬äºŒè¡ŒåŒ…å« $n$ ä¸ªæ•´æ•°ï¼Œæ•°å­—ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚

æ¥ä¸‹æ¥çš„ $M$ è¡Œï¼Œæ¯è¡Œæœ‰ä¸€ä¸ªè¯¢é—®åŒºé—´ï¼Œæ¯ä¸ªè¯¢é—®åŒºé—´åŒ…å« $2$ ä¸ªæ•´æ•° $L,R$ã€‚

#### æ•°æ®è§„æ¨¡

å¯¹äº $20 \%$ æ•°æ®, $1 \leq n, m \leq 100$;

å¯¹äºå¦å¤– $40 \%$ æ•°æ®, $1 \leq n, m \leq 1000$;

å¯¹äº $100 %$ çš„æ•°æ®, $1 \leq n, m \leq 10^5,0 \leq T < 2^{20},1\le L \le R \le n,0 \le a_i \le 2^{20}$

#### æ€è·¯
- é¦–å…ˆ,æˆ‘ä»¬æš´åŠ›è‚¯å®šè¿‡ä¸äº†.
- é¢˜ç›®è¦æ±‚ç»™å®šåŒºé—´å†…æ˜¯å¦æœ‰ä¸€å¯¹æ•°.$a,b$ æ»¡è¶³ $a^b=T$
- ç®€å•æ¨åˆ°å¯å¾—: $a^T=b$ æ˜¯ç”±ä¸Šé¢å¼å­è½¬åŒ–è€Œæ¥çš„.
- æˆ‘ä»¬éšä¾¿åˆ—ä¸€ç»„æ•°æ®,å¹¶å­˜å‚¨åˆ° $a$ æ•°ç»„é‡Œé¢: $a[]=\{2,1,3,4,2,3,2,3\}$
- ç„¶åæ²¡ä¸ªæ•°å¼‚æˆ– $T$ å¾—: $a_2[]=\{3,0,2,5,3,2,3,2\}$
- ç„¶ååœ¨æ¯ä¸ªæ•°çš„å‰é¢æŸ¥æ‰¾å¼‚æˆ– $T$ åçš„æ•°,å¦‚æœæ‰¾ä¸åˆ°æ ‡è®°ä¸º $0$ :$a_3[]=\{0,0,1,0,3,5,6,7\}$
- å¦‚æœè¦æ‰¾çš„åŒºé—´å†…å¯¹åº”çš„æ‰€æœ‰ $a_3[i]$ ä¸­æœ‰å¤§äº $L$ è€Œä¸”å°äº $R$ çš„æ•°,é‚£å°±æˆåŠŸäº†.è¾“å‡º $yes.$ å¦åˆ™å°±æ˜¯ $no$ .
- è¿™ä¸ªæ‰¾ç¬¦åˆè§„å®šçš„æ•°çš„è¿‡ç¨‹å¯ä»¥ä½¿ç”¨RMQ.è®°å½•æ¯ä¸ªåŒºé—´å†…çš„æœ€å°æ•°ç„¶åæ–¹ä¾¿ä¹‹åæŸ¥æ‰¾,å¹¶ä¸”å…·æœ‰æœ€ä¼˜æ€§.(ä¸ä¿¡å¯ä»¥è¯•è¯•ä¸åŒçš„æ•°æ®)
 
2856-å¼‚æˆ–
1.å¦‚æœ $xâŠ•y=T$ï¼Œé‚£ä¹ˆä¸€å®šæ»¡è¶³ $xâŠ•T=y$ï¼›
2.å¯¹äºæ¯ä¸ªæ•° $a_i$ï¼Œå¦‚æœèƒ½å¤Ÿå­˜å‚¨åœ¨ $a_i$ çš„å·¦ä¾§ï¼Œæœ€åä¸€ä¸ª $xâŠ•T$ çš„ä½ç½® $p$ ï¼Œé‚£ä¹ˆ $[Lï¼ŒR]$ ä¸­æ˜¯å¦å­˜åœ¨æ•°å¯¹å¼‚æˆ–åä¸º $T$ çš„æ¡ä»¶ä¸ºï¼šå¦‚æœ $[Lï¼ŒR]$ ä¸­å­˜åœ¨çš„ä¸€ä¸ª $p$ ï¼Œæ»¡è¶³ $p\ge L$ ã€‚
3.å› æ­¤æˆ‘ä»¬åªè¦æ±‚å‡º $[Lï¼ŒR]$ ä¸­æœ€å¤§çš„ $p$ ï¼Œå¦‚æœ  $p\ge L$ï¼Œå³å¯æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤ç”¨RMQï¼Œç»´æŠ¤ $[Lï¼ŒR]$ åŒºé—´ $p$ çš„æœ€å¤§å€¼ã€‚
ä¸¾ä¾‹ï¼š
$$a[]=2,1,3,4,2,3,2,3$$
$$p[]=0,0,1,0,3,5,6,7$$
$last_i$ ï¼šè®°å½•ä»»ä½•ä¸€ä¸ªæ•°çš„ä½ç½®
  - å¦‚ä½•æ±‚ $p_i$ ?
1.ç”¨ $t$ æ•°ç»„æ¥å­˜å‚¨æ¯ä¸ªæ•°çš„ä½ç½®ï¼Œæ¯é‡åˆ°ä¸€ä¸ªæ•° $a_i$ï¼Œå…¶ä½ç½® $last_{a_i}=i$ ï¼Œæ˜¾ç„¶å¦‚æœæœ‰ç›¸åŒçš„ $a_i$ï¼Œ$last_{a_i}$ å°†ä¼šè®°å½•æœ€åä¸€ä¸ª $a_i$ çš„ä½ç½®ï¼›
2.å› æ­¤æŸ¥ $a_iâŠ•T$ çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œç›´æ¥å–  $last_{a_{iâŠ•T}}$ï¼Œå¦‚æœè¯¥ä½ç½®ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º $no$ã€‚æ³¨æ„ï¼šç”±äº $a_iâŠ•T$ çš„æœ€å¤§å€¼å¯èƒ½æ˜¯ $2^{20}-1$ï¼Œå› æ­¤è¦æ³¨æ„ $last$ æ•°ç»„è¦å¼€å¤§ä¸€äº›ã€‚
![](https://img2024.cnblogs.com/blog/3594125/202503/3594125-20250305224622182-1689290442.jpg)
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 20, L = 20;
int f[N][L], p[N], ls[(1 << 20) + 10], lg[N];
int n, m, l, r, t;

int main() {
    scanf("%d%d%d", &n, &m, &t);
    for (int i = 1; i <= n; i++) {
        int x;
        scanf("%d", &x);
        p[i] = ls[x ^ t];
        ls[x] = i;
    }
    lg[1] = 0;
    for (int i = 2; i <= n; i++) lg[i] = lg[i >> 1] + 1;
    for (int i = 0; i < L; i++) {
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)  // ä¸€å®šè¦è®°å¾—iåˆå§‹å€¼ä¸º0å•Šå•Šå•Šå•Šå•Šå•Šå¿˜äº†å¥½å¤šéå•¦
                f[j][i] = p[j];
            else
                f[j][i] = max(f[j][i - 1], f[j + (1 << i - 1)][i - 1]);
        }
    }
    while (m--) {
        scanf("%d%d", &l, &r);
        int len = lg[r - l + 1];
        int maxx = max(f[l][len], f[r - (1 << len) + 1][len]);
        if (maxx >= l)
            puts("yes");
        else
            puts("no");
    }
}
```
### D.è¿ç»­kä¸ªæ•°çš„æœ€å€¼
#### é¢˜ç›®æè¿°
ç»™å®š $n$ ä¸ªæ•´æ•°ï¼Œæ±‚ä»ç¬¬ $1$ ä¸ªæ•°åˆ°ç¬¬ $n-k+1$ ä¸ªæ•°ä¸ºèµ·ç‚¹çš„æ¯ä¸ªæ•°å¼€å§‹ï¼Œè¿ç»­ $k$ ä¸ªæ•°çš„æœ€å¤§æ•°å’Œæœ€å°æ•°ã€‚
$0\le k \le n \le 10^5$
#### è¾“å…¥
```
5 3
1 2 3 4 5
```
#### è¾“å‡º
```
3 1
4 2
5 3
```
#### è§£æ³•
å¾ˆå¥½çš„æ¿å­é¢˜.è·‘ä¸¤éRMQ,åˆ†åˆ«è®°å½•æœ€å¤§æœ€å°å€¼å³å¯.
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e5 + 10, L = 20;
int f[N][L], a[N], lg[N];  // lgæ•°ç»„çš„æœ¬è´¨å°±æ˜¯æ±‚å‡ºä¸¤ä¸ªä¸‹æ ‡ä¹‹é—´çš„å·®å€¼ç„¶ålog2ä¸€ä¸‹,æ‰€ä»¥ç›´æ¥å¼€Nå°±è¡Œ
int fmi[N][L];
int n, q;

int main() {
    cin >> n >> q;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
    }
    // åˆå§‹åŒ–lgæ•°ç»„
    lg[1] = 0;
    for (int i = 2; i <= n; i++) {
        lg[i] = lg[i / 2] + 1;
    }
    // åˆå§‹åŒ–æœ€å¤§å€¼STè¡¨
    for (int i = 0; i < L; i++) {  // iä»0å¼€å§‹!!!!2^0ä¹Ÿæ˜¯æ­£æ•´æ•°!!!!
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)  // åŒä¸Šä¸ªæ³¨é‡Š
                f[j][i] = a[j];
            else
                f[j][i] = max(f[j][i - 1], f[j + (1 << (i - 1))][i - 1]);
        }
    }
    // åˆå§‹åŒ–æœ€å°å€¼STè¡¨
    for (int i = 0; i < L; i++) {
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)
                fmi[j][i] = a[j];
            else
                fmi[j][i] = min(fmi[j][i - 1], fmi[j + (1 << (i - 1))][i - 1]);
        }
    }
    // æ„é€ å®Œæ¯•.
    for (int i = 1; i + q - 1 <= n; i++) {
        int len = lg[q];
        int minn = min(fmi[i][len], fmi[i + q - 1 - (1 << len) + 1][len]);
        int maxx = max(f[i][len], f[i + q - 1 - (1 << len) + 1][len]);
        cout << maxx << " " << minn << "\n";
    }
    return 0;
}
```
#### E. ä½“è‚²è¯¾

é¢˜ç›®æè¿°

ä½“è‚²è¯¾ä¸Šï¼Œ$N$ ååŒå­¦æ’æˆäº†ä¸€æ’ï¼Œä»–ä»¬çš„ç¼–å·ä¸º $1 \sim N$ã€‚

ä½“è‚²è€å¸ˆå®‰æ’å¤§å®¶ç© $M$ è½®æ¸¸æˆï¼Œæ¯è½®æ¸¸æˆä¼šä»é‚€è¯·ç¼–å·åœ¨ $[L,R]$ ä¹‹é—´çš„çš„åŒå­¦å‚åŠ ã€‚

è¿™ä¸ªæ¸¸æˆä¸»è¦è€ƒéªŒåŒå­¦ä»¬çš„å›¢é˜Ÿåä½œèƒ½åŠ›ï¼Œä¸è¿‡ï¼Œå¦‚æœè¢«é‚€è¯·çš„åŒå­¦èº«é«˜å·®è·å¤ªå¤§ï¼Œä¼šå¾ˆéš¾å®Œæˆæ¸¸æˆã€‚

ä¸ºäº†è®©æ¯æ¬¡é‚€è¯·çš„åŒå­¦éƒ½èƒ½é¡ºåˆ©å®Œæˆæ¸¸æˆï¼Œä½“è‚²è€å¸ˆè¦æ±‚æ¯æ¬¡é€‰å–å‡ºç¼–å·åœ¨ $[L,R]$ ä¹‹é—´çš„åŒå­¦ä¹‹åï¼Œè¯·è¯¥ç»„çš„åŒå­¦å‘Šè¯‰è€å¸ˆï¼Œè¿™ç»„åŒå­¦æœ€é«˜èº«é«˜å’Œæœ€ä½èº«é«˜çš„å·®å€¼æ˜¯å¤šå°‘ã€‚è€å¸ˆå°†æ ¹æ®è¿™ä¸ªèº«é«˜çš„å·®å€¼ï¼Œæ¥è®¾ç½®æ¸¸æˆçš„éš¾åº¦ã€‚

è¾“å…¥

ç¬¬ $1$ è¡Œè¯»å…¥ $2$ ä¸ªæ•´æ•° $N,M$ã€‚

æ¥ä¸‹æ¥ $N$ è¡Œæ¯è¡Œè¯»å…¥ä¸€ä¸ªæ•´æ•°ï¼Œç¬¬ $i$ ä¸ªæ•´æ•° $A_i$ ä»£è¡¨ç¼–å·ä¸º $i$ åŒå­¦çš„èº«é«˜ã€‚

æ¥ä¸‹æ¥è¯»å…¥ $M$ è¡Œï¼Œæ¯è¡Œè¯»å…¥ $2$ ä¸ªæ•´æ•° $L,R$ï¼Œè¡¨ç¤ºè¢«é‚€è¯·å‚åŠ æ¸¸æˆåŒå­¦çš„ç¼–å·èŒƒå›´ã€‚

#### è¾“å…¥
```
6 3
1
7
3
4
2
5
1 5
4 6
2 2
```
#### è¾“å‡º
```
6
3
0
```
#### æ•°æ®èŒƒå›´

$1 \le N \le 5\times10^4$ï¼Œ$1 \le M \le 2 \times 10^5$ï¼Œ$1 \le A_i \le 10^6$ï¼Œ$1 \le L \le R \le N$ã€‚
#### è§£æ³•
è·ŸExtra T1 ä¸€æ‘¸ä¸€æ ·.æ•°æ®èŒƒå›´åå€’å°å•¦
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e4 * 5 + 10, L = 20;
int f[N][L], a[N], lg[N];  // lgæ•°ç»„çš„æœ¬è´¨å°±æ˜¯æ±‚å‡ºä¸¤ä¸ªä¸‹æ ‡ä¹‹é—´çš„å·®å€¼ç„¶ålog2ä¸€ä¸‹,æ‰€ä»¥ç›´æ¥å¼€Nå°±è¡Œ
int fmi[N][L];
int n, q, l, r;

int main() {
    scanf("%d%d", &n, &q);
    for (int i = 1; i <= n; i++) {
        scanf("%d", &a[i]);
    }
    // åˆå§‹åŒ–lgæ•°ç»„
    lg[1] = 0;
    for (int i = 2; i <= n; i++) {
        lg[i] = lg[i / 2] + 1;
    }
    // åˆå§‹åŒ–æœ€å¤§å€¼STè¡¨
    for (int i = 0; i < L; i++) {  // iä»0å¼€å§‹!!!!2^0ä¹Ÿæ˜¯æ­£æ•´æ•°!!!!
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)  // åŒä¸Šä¸ªæ³¨é‡Š
                f[j][i] = a[j];
            else
                f[j][i] = max(f[j][i - 1], f[j + (1 << (i - 1))][i - 1]);
        }
    }
    // åˆå§‹åŒ–æœ€å°å€¼STè¡¨
    for (int i = 0; i < L; i++) {
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)
                fmi[j][i] = a[j];
            else
                fmi[j][i] = min(fmi[j][i - 1], fmi[j + (1 << (i - 1))][i - 1]);
        }
    }
    // æ„é€ å®Œæ¯•.
    while (q--) {
        scanf("%d%d", &l, &r);
        int len = lg[r - l + 1];
        int maxx = max(f[l][len], f[r - (1 << len) + 1][len]);
        int minn = min(fmi[l][len], fmi[r - (1 << len) + 1][len]);
        printf("%d\n", maxx - minn);
    }
    return 0;
}
```
### Extra T1 [P2880 [USACO07JAN] Balanced Lineup G](https://www.luogu.com.cn/problem/P2880)
æ²¡ä»€ä¹ˆå¯è¯´çš„,ä¸¤æ¬¡RMQæ¿å­åˆ†åˆ«æœ€å¤§æœ€å°,è¿˜éœ€è¦å¤šæ‰“æ‰“æ¿å­é¢˜å•Š...å¥½å¤šå°ç»†èŠ‚éœ€è¦æ³¨æ„,ä½†æ˜¯å¤§ä½“ä¸Šæ²¡ä»€ä¹ˆéš¾åº¦.

```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e5 * 5 + 10, L = 20;
int f[N][L], a[N], lg[N];  // lgæ•°ç»„çš„æœ¬è´¨å°±æ˜¯æ±‚å‡ºä¸¤ä¸ªä¸‹æ ‡ä¹‹é—´çš„å·®å€¼ç„¶ålog2ä¸€ä¸‹,æ‰€ä»¥ç›´æ¥å¼€Nå°±è¡Œ
int fmi[N][L];
int n, q, l, r;

int main() {
    cin >> n >> q;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
    }
    // åˆå§‹åŒ–lgæ•°ç»„
    lg[1] = 0;
    for (int i = 2; i <= n; i++) {
        lg[i] = lg[i / 2] + 1;
    }
    // åˆå§‹åŒ–æœ€å¤§å€¼STè¡¨
    for (int i = 0; i < L; i++) {  // iä»0å¼€å§‹!!!!2^0ä¹Ÿæ˜¯æ­£æ•´æ•°!!!!
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)  // åŒä¸Šä¸ªæ³¨é‡Š
                f[j][i] = a[j];
            else
                f[j][i] = max(f[j][i - 1], f[j + (1 << (i - 1))][i - 1]);
        }
    }
    // åˆå§‹åŒ–æœ€å°å€¼STè¡¨
    for (int i = 0; i < L; i++) {
        for (int j = 1; j + (1 << i) - 1 <= n; j++) {
            if (i == 0)
                fmi[j][i] = a[j];
            else
                fmi[j][i] = min(fmi[j][i - 1], fmi[j + (1 << (i - 1))][i - 1]);
        }
    }
    // æ„é€ å®Œæ¯•.
    while (q--) {
        cin >> l >> r;
        int len = lg[r - l + 1];
        int maxx = max(f[l][len], f[r - (1 << len) + 1][len]);
        int minn = min(fmi[l][len], fmi[r - (1 << len) + 1][len]);
        cout << maxx - minn << "\n";
    }
    return 0;
}
```
### ExtraT2 P3865 ã€æ¨¡æ¿ã€‘ST è¡¨ && RMQ é—®é¢˜
#### è§£æ³•
å°±æ˜¯æ¨¡ç‰ˆå¥½å§,ä¸ä¼šçš„è¯·çœ‹Aé¢˜,æ³¨æ„:æ—¶é—´é™åˆ¶0.8s
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e5 + 10, L = 20;
int a[N], f[N][L];
int lg[N];
int n, m, x, y, k;
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i++) {
        scanf("%d", &a[i]);
    }
    lg[1] = 0;
    for (int i = 2; i <= n; i++) lg[i] = lg[i / 2] + 1;
    for (int j = 0; j < L; j++) {
        for (int i = 1; i + (1 << j) - 1 <= n; i++) {
            if (j == 0)
                f[i][j] = a[i];
            else
                f[i][j] = max(f[i][j - 1], f[i + (1 << j - 1)][j - 1]);
        }
    }
    while (m--) {
        scanf("%d%d", &x, &y);
        k = lg[y - x + 1];
        printf("%d\n", max(f[x][k], f[y - (1 << k) + 1][k]));
    }
}
```

![](https://img2024.cnblogs.com/blog/3594125/202503/3594125-20250303202219501-1304077497.png)
